{
  "dashboard": {
    "id": null,
    "uid": "enodai-production",
    "title": "EnodAI Production Dashboard",
    "tags": ["enodai", "production"],
    "timezone": "browser",
    "schemaVersion": 39,
    "fiscalYearStartMonth": 0,
    "refresh": "30s",
    "panels": [
      {
        "datasource": {
          "type": "postgres",
          "uid": "PCC52D03280B7034C"
        },
        "fieldConfig": {
          "defaults": {
            "color": {"mode": "thresholds"},
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "green", "value": null},
                {"color": "orange", "value": 1},
                {"color": "red", "value": 3}
              ]
            }
          }
        },
        "gridPos": {"h": 8, "w": 6, "x": 0, "y": 0},
        "id": 1,
        "options": {
          "colorMode": "background",
          "graphMode": "none",
          "textMode": "value_and_name"
        },
        "targets": [
          {
            "datasource": {"type": "postgres", "uid": "PCC52D03280B7034C"},
            "editorMode": "code",
            "format": "table",
            "rawSql": "SELECT COUNT(*) as value FROM alerts WHERE status = 'firing'",
            "refId": "A",
            "sql": {"columns": [{"parameters": [], "type": "function"}], "groupBy": [{"property": {"type": "string"}, "type": "groupBy"}], "limit": 50}
          }
        ],
        "title": "üö® Active Alerts",
        "type": "stat"
      },
      {
        "datasource": {
          "type": "postgres",
          "uid": "PCC52D03280B7034C"
        },
        "fieldConfig": {
          "defaults": {
            "color": {"mode": "thresholds"},
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "green", "value": null},
                {"color": "yellow", "value": 10},
                {"color": "red", "value": 30}
              ]
            }
          }
        },
        "gridPos": {"h": 8, "w": 6, "x": 6, "y": 0},
        "id": 2,
        "options": {
          "colorMode": "background",
          "graphMode": "area",
          "textMode": "value_and_name"
        },
        "targets": [
          {
            "datasource": {"type": "postgres", "uid": "PCC52D03280B7034C"},
            "editorMode": "code",
            "format": "table",
            "rawSql": "SELECT COUNT(*) as value FROM metrics WHERE is_anomaly = TRUE",
            "refId": "A"
          }
        ],
        "title": "ü§ñ AI Anomalies Detected",
        "type": "stat"
      },
      {
        "datasource": {
          "type": "postgres",
          "uid": "PCC52D03280B7034C"
        },
        "fieldConfig": {
          "defaults": {
            "color": {"mode": "thresholds"},
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "blue", "value": null},
                {"color": "green", "value": 5},
                {"color": "purple", "value": 10}
              ]
            }
          }
        },
        "gridPos": {"h": 8, "w": 6, "x": 12, "y": 0},
        "id": 3,
        "options": {
          "colorMode": "background",
          "graphMode": "area",
          "textMode": "value_and_name"
        },
        "targets": [
          {
            "datasource": {"type": "postgres", "uid": "PCC52D03280B7034C"},
            "editorMode": "code",
            "format": "table",
            "rawSql": "SELECT COUNT(*) as value FROM ai_analysis_results r INNER JOIN alerts a ON r.alert_id = a.id WHERE r.analysis_type = 'llm_analysis' AND a.status = 'firing'",
            "refId": "A"
          }
        ],
        "title": "üß† LLM Analyses Completed",
        "type": "stat"
      },
      {
        "datasource": {
          "type": "postgres",
          "uid": "PCC52D03280B7034C"
        },
        "fieldConfig": {
          "defaults": {
            "color": {"mode": "thresholds"},
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "green", "value": null},
                {"color": "yellow", "value": 3},
                {"color": "orange", "value": 10}
              ]
            },
            "unit": "short",
            "mappings": []
          }
        },
        "gridPos": {"h": 8, "w": 6, "x": 18, "y": 0},
        "id": 4,
        "options": {
          "colorMode": "background",
          "graphMode": "area",
          "textMode": "value_and_name",
          "orientation": "auto",
          "reduceOptions": {
            "values": false,
            "calcs": ["lastNotNull"],
            "fields": ""
          }
        },
        "targets": [
          {
            "datasource": {"type": "postgres", "uid": "PCC52D03280B7034C"},
            "editorMode": "code",
            "format": "table",
            "rawSql": "SELECT COUNT(*) as value FROM alerts WHERE is_duplicate = TRUE AND status = 'firing'",
            "refId": "A"
          }
        ],
        "title": "üîÑ Duplicates Skipped",
        "type": "stat",
        "description": "Number of duplicate alerts skipped by smart deduplication. Each skipped alert = CPU time saved!"
      },
      {
        "datasource": {
          "type": "postgres",
          "uid": "PCC52D03280B7034C"
        },
        "fieldConfig": {
          "defaults": {},
          "overrides": [
            {
              "matcher": {"id": "byName", "options": "Severity"},
              "properties": [
                {
                  "id": "custom.cellOptions",
                  "value": {"type": "color-background"}
                },
                {
                  "id": "mappings",
                  "value": [
                    {
                      "options": {
                        "pattern": "critical.*",
                        "result": {"color": "red", "index": 0}
                      },
                      "type": "regex"
                    },
                    {
                      "options": {
                        "pattern": "warning.*",
                        "result": {"color": "orange", "index": 1}
                      },
                      "type": "regex"
                    },
                    {
                      "options": {
                        "pattern": "info.*",
                        "result": {"color": "blue", "index": 2}
                      },
                      "type": "regex"
                    }
                  ]
                }
              ]
            },
            {
              "matcher": {"id": "byName", "options": "Case No"},
              "properties": [{"id": "custom.width", "value": 120}]
            }
          ]
        },
        "gridPos": {"h": 40, "w": 24, "x": 0, "y": 8},
        "id": 5,
        "options": {
          "cellHeight": "auto",
          "showHeader": true
        },
        "targets": [
          {
            "datasource": {"type": "postgres", "uid": "PCC52D03280B7034C"},
            "editorMode": "code",
            "format": "table",
            "rawSql": "WITH latest_analyses AS (SELECT DISTINCT ON (a.alert_name, a.labels->>'instance') a.id as alert_id, a.alert_name, a.severity, a.labels->>'instance' as instance, a.created_at, r.id as analysis_id, r.analysis_data, r.metadata, r.created_at as analysis_time, (SELECT COUNT(*) FROM alerts dup WHERE dup.alert_name = a.alert_name AND dup.labels->>'instance' = a.labels->>'instance' AND dup.created_at >= NOW() - INTERVAL '1 hour' AND (dup.is_duplicate = TRUE OR dup.id = a.id)) as dup_count FROM alerts a INNER JOIN ai_analysis_results r ON a.id = r.alert_id AND r.analysis_type = 'llm_analysis' WHERE a.is_duplicate = FALSE ORDER BY a.alert_name, a.labels->>'instance', a.created_at DESC) SELECT SUBSTRING(alert_id::text, 1, 8) as \"Case No\", alert_name as \"Alert\", CASE WHEN metadata::jsonb->>'analysis_reason' = 'recovery' THEN severity || ' ‚≠ê' WHEN metadata::jsonb->>'analysis_reason' = 'escalation' THEN severity || ' üî•' ELSE severity END as \"Severity\", instance as \"Instance\", dup_count as \"Count\", COALESCE(analysis_data::jsonb->'root_cause'->>'problem', analysis_data::jsonb->'root_cause'->>'recovery_status', 'Analysis in progress...') as \"Root Cause\", CASE WHEN analysis_data::jsonb ? 'immediate_actions' THEN (SELECT string_agg('STEP ' || (action->>'step') || ': ' || (action->>'action') || COALESCE(' [' || (action->>'command') || ']', '') || ' (' || (action->>'time') || ')', E'\\n\\n') FROM jsonb_array_elements(analysis_data::jsonb->'immediate_actions') AS action) ELSE 'Generating...' END as \"üö® IMMEDIATE ACTIONS\", to_char(analysis_time, 'MM-DD HH24:MI') as \"Time\" FROM latest_analyses ORDER BY analysis_time DESC LIMIT 15",
            "refId": "A"
          }
        ],
        "title": "üîç AI Root Cause Analysis & Action Plan",
        "type": "table"
      }
    ]
  },
  "folderUid": "",
  "overwrite": true
}
