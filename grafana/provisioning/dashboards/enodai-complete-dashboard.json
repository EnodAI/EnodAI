{
  "dashboard": {
    "title": "EnodAI - AI Intelligence Dashboard",
    "tags": ["enodai", "ai", "production"],
    "timezone": "browser",
    "refresh": "30s",
    "editable": true,
    "panels": [
      {
        "id": 1,
        "title": "ü§ñ AI Anomalies Detected",
        "type": "stat",
        "gridPos": {"h": 8, "w": 6, "x": 0, "y": 0},
        "targets": [{
          "datasource": {"type": "grafana-postgresql-datasource", "uid": "dfcpezliqnyf4a"},
          "rawSql": "SELECT COUNT(*) as value FROM metrics",
          "format": "table",
          "refId": "A"
        }],
        "fieldConfig": {
          "defaults": {
            "unit": "short",
            "color": {"mode": "thresholds"},
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": 0, "color": "green"},
                {"value": 10, "color": "yellow"},
                {"value": 30, "color": "red"}
              ]
            }
          }
        },
        "options": {
          "textMode": "value_and_name",
          "graphMode": "area",
          "colorMode": "background"
        }
      },
      {
        "id": 2,
        "title": "üß† LLM Analyses Completed",
        "type": "stat",
        "gridPos": {"h": 8, "w": 6, "x": 6, "y": 0},
        "targets": [{
          "datasource": {"type": "grafana-postgresql-datasource", "uid": "dfcpezliqnyf4a"},
          "rawSql": "SELECT COUNT(*) as value FROM ai_analysis_results WHERE analysis_type = 'llm_analysis'",
          "format": "table",
          "refId": "A"
        }],
        "fieldConfig": {
          "defaults": {
            "unit": "short",
            "color": {"mode": "thresholds"},
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": 0, "color": "blue"},
                {"value": 5, "color": "green"},
                {"value": 10, "color": "purple"}
              ]
            }
          }
        },
        "options": {
          "textMode": "value_and_name",
          "graphMode": "area",
          "colorMode": "background"
        }
      },
      {
        "id": 3,
        "title": "üìä Total Metrics Collected",
        "type": "stat",
        "gridPos": {"h": 8, "w": 6, "x": 12, "y": 0},
        "targets": [{
          "datasource": {"type": "grafana-postgresql-datasource", "uid": "dfcpezliqnyf4a"},
          "rawSql": "SELECT COUNT(*) as value FROM metrics",
          "format": "table",
          "refId": "A"
        }],
        "fieldConfig": {
          "defaults": {
            "unit": "short",
            "color": {"mode": "palette-classic"}
          }
        },
        "options": {
          "textMode": "value_and_name",
          "graphMode": "area"
        }
      },
      {
        "id": 4,
        "title": "üö® Active Alerts",
        "type": "stat",
        "gridPos": {"h": 8, "w": 6, "x": 18, "y": 0},
        "targets": [{
          "datasource": {"type": "grafana-postgresql-datasource", "uid": "dfcpezliqnyf4a"},
          "rawSql": "SELECT COUNT(*) as value FROM alerts WHERE status = 'firing'",
          "format": "table",
          "refId": "A"
        }],
        "fieldConfig": {
          "defaults": {
            "unit": "short",
            "color": {"mode": "thresholds"},
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": 0, "color": "green"},
                {"value": 1, "color": "orange"},
                {"value": 3, "color": "red"}
              ]
            }
          }
        },
        "options": {
          "textMode": "value_and_name",
          "graphMode": "none",
          "colorMode": "background"
        }
      },
      {
        "id": 5,
        "title": "üîç AI Root Cause Analysis & Action Plan",
        "type": "table",
        "gridPos": {"h": 16, "w": 24, "x": 0, "y": 8},
        "targets": [{
          "datasource": {"type": "grafana-postgresql-datasource", "uid": "dfcpezliqnyf4a"},
          "rawSql": "SELECT \n  a.alert_name as \"Alert\",\n  a.severity as \"Severity\",\n  COALESCE(\n    r.analysis_data::jsonb->'root_cause'->>'technical_reason',\n    r.analysis_data::json->>'root_cause',\n    'Analysis in progress...'\n  ) as \"Root Cause\",\n  CASE \n    WHEN r.analysis_data::jsonb ? 'immediate_actions' THEN\n      'üî¥ ' || \n      (SELECT string_agg(\n        '‚Ä¢ ' || (action->>'action') || ' (' || (action->>'estimated_time') || ')',\n        E'\\n'\n      ) FROM jsonb_array_elements(r.analysis_data::jsonb->'immediate_actions') AS action)\n    ELSE\n      COALESCE(r.analysis_data::json->>'mitigation', 'Generating...')\n  END as \"üî¥ Immediate (0-2h)\",\n  CASE \n    WHEN r.analysis_data::jsonb ? 'short_term_actions' THEN\n      'üü° ' ||\n      (SELECT string_agg(\n        '‚Ä¢ ' || (action->>'action'),\n        E'\\n'\n      ) FROM jsonb_array_elements(r.analysis_data::jsonb->'short_term_actions') AS action LIMIT 2)\n    ELSE\n      NULL\n  END as \"üü° Short-Term (1-2d)\",\n  CASE \n    WHEN r.analysis_data::jsonb ? 'long_term_actions' THEN\n      'üü¢ ' ||\n      (SELECT string_agg(\n        '‚Ä¢ ' || (action->>'action'),\n        E'\\n'\n      ) FROM jsonb_array_elements(r.analysis_data::jsonb->'long_term_actions') AS action LIMIT 2)\n    ELSE\n      NULL\n  END as \"üü¢ Long-Term (1-7d)\",\n  to_char(r.created_at, 'MM-DD HH24:MI') as \"Time\"\nFROM ai_analysis_results r\nLEFT JOIN alerts a ON r.alert_id = a.id\nWHERE r.analysis_type = 'llm_analysis'\nORDER BY r.created_at DESC\nLIMIT 10",
          "format": "table",
          "refId": "A"
        }],
        "options": {
          "showHeader": true,
          "footer": {
            "show": false
          },
          "cellHeight": "md"
        },
        "fieldConfig": {
          "overrides": [
            {
              "matcher": {"id": "byName", "options": "Severity"},
              "properties": [
                {
                  "id": "custom.cellOptions",
                  "value": {
                    "type": "color-background"
                  }
                },
                {
                  "id": "mappings",
                  "value": [
                    {
                      "type": "value",
                      "options": {
                        "critical": {
                          "color": "red",
                          "index": 0
                        }
                      }
                    },
                    {
                      "type": "value",
                      "options": {
                        "warning": {
                          "color": "yellow",
                          "index": 1
                        }
                      }
                    }
                  ]
                }
              ]
            }
          ]
        }
      },
      {
        "id": 6,
        "title": "‚ö†Ô∏è Recent Metrics Overview",
        "type": "table",
        "gridPos": {"h": 10, "w": 12, "x": 0, "y": 24},
        "targets": [{
          "datasource": {"type": "grafana-postgresql-datasource", "uid": "dfcpezliqnyf4a"},
          "rawSql": "SELECT \n  metric_name as \"Metric\",\n  ROUND(AVG(metric_value)::numeric, 2) as \"Avg Value\",\n  COUNT(*) as \"Count\",\n  to_char(MAX(timestamp), 'HH24:MI:SS') as \"Last Seen\"\nFROM metrics\nGROUP BY metric_name\nORDER BY MAX(timestamp) DESC\nLIMIT 10",
          "format": "table",
          "refId": "A"
        }],
        "options": {
          "showHeader": true
        }
      },
      {
        "id": 7,
        "title": "üö® Critical Alerts",
        "type": "table",
        "gridPos": {"h": 10, "w": 12, "x": 12, "y": 24},
        "targets": [{
          "datasource": {"type": "grafana-postgresql-datasource", "uid": "dfcpezliqnyf4a"},
          "rawSql": "SELECT \n  alert_name as \"Alert Name\",\n  severity as \"Severity\",\n  status as \"Status\",\n  LEFT(description, 60) as \"Description\",\n  to_char(created_at, 'MM-DD HH24:MI') as \"Created\"\nFROM alerts\nWHERE severity IN ('critical', 'warning')\nORDER BY \n  CASE severity \n    WHEN 'critical' THEN 1 \n    WHEN 'warning' THEN 2 \n    ELSE 3 \n  END,\n  created_at DESC\nLIMIT 10",
          "format": "table",
          "refId": "A"
        }],
        "options": {
          "showHeader": true
        },
        "fieldConfig": {
          "overrides": [
            {
              "matcher": {"id": "byName", "options": "Severity"},
              "properties": [
                {
                  "id": "custom.cellOptions",
                  "value": {
                    "type": "color-background"
                  }
                },
                {
                  "id": "mappings",
                  "value": [
                    {
                      "type": "value",
                      "options": {
                        "critical": {
                          "color": "red",
                          "index": 0
                        }
                      }
                    },
                    {
                      "type": "value",
                      "options": {
                        "warning": {
                          "color": "yellow",
                          "index": 1
                        }
                      }
                    }
                  ]
                }
              ]
            }
          ]
        }
      }
    ]
  },
  "overwrite": true
}
